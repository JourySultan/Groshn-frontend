<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="header.css">
    <link rel="stylesheet" href="product-details.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="commonscript.js"></script>


<script>

    document.addEventListener("DOMContentLoaded", function () {
        const API_URL = "https://Groshn.onrender.com/api/crops/";
        const AUTH_TOKEN = "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2N2UxNWFhZWExMDM3ZDc5MjBkMjU4MzEiLCJpYXQiOjE3NDI4MjIxNTR9.Gdw5qT1YFtshj4o1BZ-RePBBtqV2_hBXyTII6-YN-vQ";
    
        // Tab functionality
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
    
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.getAttribute('data-tab');
                
                // Remove active class from all buttons and contents
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                // Add active class to clicked button and corresponding content
                button.classList.add('active');
                document.getElementById(tabId).classList.add('active');
            });
        });
    
        // Fetch product data
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get("id");
    
        if (!productId) {
            showError("Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†ØªØ¬");
            return;
        }
    
        fetch(`${API_URL}${productId}`, {
            headers: { Authorization: AUTH_TOKEN }
        })
        .then(res => {
            if (!res.ok) throw new Error("ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
            return res.json();
        })
        .then(product => {
            updateProductUI(product);
        })
        .catch(err => {
            console.error("Ø®Ø·Ø£:", err);
            showError(err.message);
        });
    });
    
    function updateProductUI(product) {
        // Update basic product info
        document.querySelector(".product-image").src = product.image || "photos/default.png";
        document.querySelector(".product-title").textContent = product.name;
        document.querySelector(".product-description").textContent = product.cropsDescreption;
        document.querySelector(".product-price").textContent = `${product.price} Ø±ÙŠØ§Ù„`;
        
        // Show organic badge if product is organic
        const organicBadge = document.getElementById("organicBadge");
        if (product.isOrganic) {
            organicBadge.style.display = "block";
        }
    
        // Update tab contents
        document.querySelector(".product-importance").textContent = product.cropImportance;
        document.querySelector(".product-storage").textContent = product.cropStoreMethod;
        
        // Create detailed description with grid layout
        const descriptionHTML = `
            <div class="detail-item">
                <strong>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­ØµØ§Ø¯</strong>
                <span>${product.harvestMethod || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}</span>
            </div>
            <div class="detail-item">
                <strong>Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬</strong>
                <span>${product.isOrganic ? "Ø¹Ø¶ÙˆÙŠ" : "ØºÙŠØ± Ø¹Ø¶ÙˆÙŠ"}</span>
            </div>
            <div class="detail-item">
                <strong>Ù†ÙˆØ¹ Ø§Ù„Ø³Ù…Ø§Ø¯</strong>
                <span>${product.fertilizer || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}</span>
            </div>
            <div class="detail-item">
                <strong>Ù†Ø¸Ø§Ù… Ø§Ù„Ø²Ø±Ø§Ø¹Ø©</strong>
                <span>${product.farmingMethod || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}</span>
            </div>
            <div class="detail-item">
                <strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­ØµØ§Ø¯</strong>
                <span>${product.harvestDate || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}</span>
            </div>
            <div class="detail-item">
                <strong>Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ù…ØªÙˆØ³Ø·</strong>
                <span>${product.size || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}</span>
            </div>
            <div class="detail-item">
                <strong>Ø­Ø¬Ù… Ø§Ù„Ø¹Ø¨ÙˆØ©</strong>
                <span>${product.packageSize || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}</span>
            </div>
        `;
        
        document.querySelector(".product-full-description").innerHTML = descriptionHTML;
        const addToCartBtn = document.getElementById("addToCartBtn");
        addToCartBtn.onclick = () => addToCart(product._id, product.name, product.price);
    }
    
    function showError(message) {
        const container = document.querySelector('.container');
        container.innerHTML = `
            <div class="error-message">
                <h2>âš ï¸ ${message}</h2>
                <a href="index.html" class="add-btn">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            </div>
        `;
    }
    async function addToCart(cropId, name, price) {
        const token = localStorage.getItem("token");
        if (!token) {
          alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
          window.location.href = "login.html";
          return;
        }
  
        try {
          const res = await fetch("https://groshn.onrender.com/api/cart", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`
            },
            body: JSON.stringify({
              cropId,
              name,
              price,
              quantity: 1
            })
          });
  
          const data = await res.json();
  
          if (res.ok) {
            alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©!");
          } else {
            alert("ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬: " + (data.message || "Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ù‹Ø§"));
          }
        } catch (error) {
          alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø¹Ù†Ø¯ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©");
          console.error(error);
        }
      }
  
</script>
</head>
<body>
    <div id="header-container" ></div>

    <main class="container">
        <div class="product-container">
            <div class="product-gallery">
                <img class="product-image" src="" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬">
                <div class="organic-badge" id="organicBadge" style="display: none;">
                    Ø¹Ø¶ÙˆÙŠ
                </div>
            </div>
            
            <div class="product-details">
                <h1 class="product-title">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</h1>
                <p class="product-description">ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬...</p>
                <div class="price-section">
                    <span class="price product-price">Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬...</span>
                  
                    <button class="add-btn" id="addToCartBtn"> 
                        <span class="btn-text">Ø§Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©</span>
                        <span class="btn-icon">ğŸ›’</span>
                    </button>
                    
                </div>

                <div class="tabs-container">
                    <div class="tabs">
                        <button class="tab-btn active" data-tab="desc">
                            <span class="tab-icon">ğŸ“</span>
                            ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬
                        </button>
                        <button class="tab-btn" data-tab="benefits">
                            <span class="tab-icon">âœ¨</span>
                            ÙÙˆØ§Ø¦Ø¯ Ø§Ù„Ù…Ù†ØªØ¬
                        </button>
                        <button class="tab-btn" data-tab="storage">
                            <span class="tab-icon">ğŸª</span>
                            Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ†
                        </button>
                        <button class="tab-btn" data-tab="reviews">
                            <span class="tab-icon">â­</span>
                            Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
                        </button>
                    </div>

                    <div class="tab-content active" id="desc">
                        <div class="product-full-description"></div>
                    </div>

                    <div class="tab-content" id="benefits">
                        <p class="product-importance"></p>
                    </div>

                    <div class="tab-content" id="storage">
                        <p class="product-storage"></p>
                    </div>

                    <div class="tab-content" id="reviews">
                        <div class="reviews-container">
                            <p>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ù‚Ø±ÙŠØ¨Ø§Ù‹</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2024</p>
    </footer>

    <script src="script.js"></script>
</body>
</html>
